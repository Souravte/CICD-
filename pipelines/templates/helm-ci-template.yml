steps:
    - task: Docker@2
      displayName: 'Build & Push Docker Image to ACR'
      inputs:
        containerRegistry: '${{ parameters.dockerRegistry_sc }}'
        repository: '${{ parameters.projectName }}'
        command: 'buildAndPush'
        Dockerfile: '${{ parameters.projectName }}/Dockerfile'
        tags: '${{ parameters.appVersion }}'
        
    - task: HelmInstaller@0
      displayName: 'Install Helm'
      inputs:
        helmVersion: '3.6.2'
        checkLatestHelmVersion: false
        installKubectl: true
        
    - task: HelmDeploy@0
      displayName: Save Helm Package to ACR
      inputs:
        azureSubscriptionForACR: $(service_connection)
        azureResourceGroupForACR: $(aksrg)
        azureContainerRegistry: $(containerRegistry)
        command: 'save'
        chartNameForACR: ${{ parameters.chartName }}
        chartPathForACR: '${{ parameters.projectName }}/${{ parameters.chartName }}'
      env:
        HELM_EXPERIMENTAL_OCI: 1
      
    
    
